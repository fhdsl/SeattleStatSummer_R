---
title: "Manipulating Data in R Lab"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)
```

# Part 1

1. Read in the SARS-CoV-2 Vaccination data. Assign the data the name "vacc". This data is current as of January 12, 2022! We will be reviewing new concepts here and incorporating some from week 1.

```{r}
# vacc <- read_csv("http://jhudatascience.org/intro_to_R_class/data/USA_covid19_vaccinations.csv")
# If downloaded
vacc <- read_csv("USA_covid19_vaccinations.csv")
```

2. Look at the column names using `colnames` - do you notice any patterns?

```{r}
colnames(vacc)
# Looks like many start with "percent" and some start with "total" - this indicates there are different units of measure for these different variables!
```

3. Let's rename the column "State/Territory/Federal Entity" in "vacc" to "Entity" using `rename`.

```{r}
vacc <- vacc %>% rename(Entity = `State/Territory/Federal Entity`)
```

4. Create a new dataset "vacc_long" that does `pivot_longer` on all columns starting with "Percent". Use `starts_with("Percent")` for the `cols` argument. Use "Measure" for the `names_to` argument. Use "Percent" for the `values_to` argument.

```{r}
vacc_long <- vacc %>% pivot_longer( starts_with("Percent"),
                                    names_to = "Measure",
                                    values_to = "Percent")
```

5. Select only the columns "Entity", "Measure", and "Percent" from this new dataset. Use `select`. Filter "Entity" so it only includes values in the following list: "Maryland","Virginia","Florida","Massachusetts", "United States". **Hint**: use `filter` and `%in%`

```{r}
vacc_long <- vacc_long %>% select(Entity, Measure, Percent) %>% 
  filter(Entity %in% c("Maryland","Virginia","Florida","Massachusetts", "United States"))
```

6. Use `pivot_wider` to reshape "vacc_long". Use "Entity" for the `names_from` argument. Use "Percent" for the `values_from` argument.

```{r}
vacc_wide <- vacc_long %>% 
  pivot_wider(names_from = Entity,
              values_from = Percent)
```

# Part 2

Use this code if you need to reload libraries and the data on day 2:

```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)

crash = read_csv("http://jhudatascience.org/intro_to_R_class/Manipulating_Data_in_R/lab/crashes.csv")
road = read_csv("http://jhudatascience.org/intro_to_R_class/Manipulating_Data_in_R/lab/roads.csv")
```

7. Join data to retain only complete data, (using an inner join) e.g. those observations with road lengths and districts.  Merge without using `by` argument, then merge using `by = "Road"`. call the output `merged.`  How many observations are there?

```{r}
merged = inner_join(crash, road)
merged = inner_join(crash, road, by = "Road")
nrow(merged)
```

8. Join data using a `full_join.`  Call the output `full.`   How many observations are there?

```{r}
full = full_join(crash, road)
nrow(full)
```

9. Do a left join of the `road` and `crash`.  ORDER matters here!  How many observations are there?

```{r}
left = left_join(road, crash)
nrow(left)
```

10. Repeat above with a `right_join` with the same order of the arguments. How many observations are there?

```{r}
right = right_join(road, crash)
nrow(right)
```

**Bonus**

Repeat #4 - #6 but instead look for columns that start with "Total" and select different states/Entities to compare. Also try combining all functions in one long block using the pipe `%>%`.

```{r}
vacc_wide <-
  vacc %>%
  pivot_longer(starts_with("Total"), names_to = "Measure", values_to = "Total") %>%
  select(Entity, Measure, Total) %>%
  filter(Entity %in% c("Alaska", "Kansas", "California", "United States")) %>%
  pivot_wider(names_from = Entity, values_from = Total)
  
```


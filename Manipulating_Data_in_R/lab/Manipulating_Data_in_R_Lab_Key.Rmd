---
title: "Manipulating Data in R Lab"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
library(stringr)
```

# Part 1

1.  Read in the Wide Bike lanes data: http://jhudatascience.org/intro_to_r/data/Bike_Lanes_Wide.csv .  Name the data set `wide`. Note the `NA`s here!

```{r}
wide = read_csv("http://jhudatascience.org/intro_to_r/data/Bike_Lanes_Wide.csv")
```

2. Reshape `wide` using `pivot_longer.`  Call this data `long.`  Make the `names_to`
`lanetype`, and the values `the_length.`  Make sure we pivot all columns **but**
`name`, using `!name`. Note the `NA`s here:

```{r}
long = wide %>% 
  pivot_longer(!name,
               names_to = "lanetype", values_to = "the_length")
head(long)
```

3. read in the roads and crashes CSVs.  Call them `crash` and `road`
`crash`: http://jhudatascience.org/intro_to_r/Manipulating_Data_in_R/lab/crashes.csv
`road`: http://jhudatascience.org/intro_to_r/Manipulating_Data_in_R/lab/roads.csv

(This exercise is motivated by https://anythingbutrbitrary.blogspot.com/2012/08/manipulating-data-frames-using-sqldf.html)

```{r}
crash = read_csv("http://jhudatascience.org/intro_to_r/Manipulating_Data_in_R/lab/crashes.csv")
road = read_csv("http://jhudatascience.org/intro_to_r/Manipulating_Data_in_R/lab/roads.csv")
head(crash)
head(road)
```

4.  Replace (using `str_replace`) any hyphens (`-`) with a space in the `Road` column. Call this data `crash2`. Use `table()` to look at the `Road` column.  
```{r}
crash2 = crash %>% 
  mutate(Road = str_replace(Road, "-", " "))
table(crash2$Road)
```

5. How many observations are in each dataset?
```{r}
dim(crash)
dim(road)
```

6. Select all the columns from `crash2` except `Volume` using the `!` and `select()`. Then use `pivot_wider()` to make the dataset wide, turning the column `Year` into many columns. The data in these new columns should come from `N_Crashes`. Call the new data `wide_crash2`. What are the column names now?

```{r}
wide_crash2 = crash2 %>%
  select(!Volume) %>%
  pivot_wider(names_from = "Year", values_from = N_Crashes)
colnames(wide_crash2)
```


# Part 2

7. Join data to retain only complete data, (using an inner join) e.g. those observations with road lengths and districts.  Merge without using `by` argument, then merge using `by = "Road"`. call the output `merged.`  How many observations are there?

```{r}
merged = inner_join(crash, road)
merged = inner_join(crash, road, by = "Road")
nrow(merged)
```

8. Join data using a `full_join.`  Call the output `full.`   How many observations are there?

```{r}
full = full_join(crash, road)
nrow(full)
```

9. Do a left join of the `road` and `crash`.  ORDER matters here!  How many observations are there?

```{r}
left = left_join(road, crash)
nrow(left)
```

10. Repeat above with a `right_join` with the same order of the arguments. How many observations are there?

```{r}
right = right_join(road, crash)
nrow(right)
```

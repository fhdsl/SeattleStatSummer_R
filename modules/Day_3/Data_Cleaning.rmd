---
title: "Data Cleaning"
output:
  ioslides_presentation:
    css: ../../docs/styles.css
    widescreen: yes
editor_options: 
  markdown: 
    wrap: 72
---

```{r, echo = FALSE, message = FALSE}
library(knitr)
opts_chunk$set(comment = "")
library(readr)
suppressPackageStartupMessages(library(dplyr))
library(tidyverse)
```

## Recap on summarization

-   `summary(x)`: quantile information
-   `summarize`: creates a summary table of columns of interest
-   `count(variable)`: how many of each unique value do you have
-   `group_by()`: changes all subsequent functions
    -   combine with `summarize()` to get statistics per group

üìÉ[Cheatsheet](https://jhudatascience.org/intro_to_r/modules/cheatsheets/Day-4.pdf)


## Data Cleaning {.emphasized}

In general, data cleaning is a process of investigating your data for
inaccuracies, or recoding it in a way that makes it more manageable.

::: {style="color: red;"}

`r emo::ji("warning")` MOST IMPORTANT RULE - LOOK `r emo::ji("eyes")` AT YOUR DATA! `r emo::ji("warning")`

:::


# Dealing with Missing Data



## Air quality data

The `airquality` dataset comes with R about air quality in New York in 1973.

```{r, message=FALSE}
?airquality # use this to find out more about the data
airqual <- tibble(airquality)
airqual
```

## We can use `count` to see missing values

The will be at the bottom typically

```{r}
Ozone_values<-count(airqual, Ozone)
tail(Ozone_values)
```



## Missing Data Issues

Recall that mathematical operations with `NA` often result in `NA`s.

```{r}
sum(c(1,2,3,NA))
mean(c(1,2,3,NA))
median(c(1,2,3,NA))
```


## filter() and missing data

Be **careful** with missing data using subsetting!

**`filter()` removes missing values by default.** Because R can't tell
for sure if an `NA` value meets the condition. To keep them need to add
`is.na()` conditional.

Think about if this is OK or not - it depends on your data!



## To remove **rows** with `NA` values for a **variable** use `drop_na()`

A function from the `tidyr` package. (Need a data frame to start!)

Disclaimer: Don't do this unless you have thought about if dropping `NA` values makes sense based on knowing what these values mean in your data.

```{r}
dim(airqual)
airqual %>% drop_na(Ozone)
```



## To remove rows with `NA` values for a **data frame** use `drop_na()`

This function of the `tidyr` package drops rows with **any** missing data in **any** column when used on a df.

```{r}
airqual %>% drop_na()
```



## Summary

-   `count()` can help determine if we have `NA` values
-   `filter()` automatically removes `NA` values - can't confirm or deny
    if condition is met (need `| is.na()` to keep them)
-   `drop_na()` can help you remove `NA` values from a variable or an
    entire data frame
-   `NA` values can change your calculation results
-   think about what `NA` values represent - don't drop them if you shouldn't

## Lab Part 1

üè† [Class Website](https://jhudatascience.org/intro_to_r/)    
üíª[Lab](https://jhudatascience.org/intro_to_r/modules/Data_Cleaning/lab/Data_Cleaning_Lab.Rmd)



# Recoding Variables

## changing data class

```{r}

```
## Example of Recoding

```{r}
library(catdata)
?catdata::teratology2
data(teratology2)
```

```{r, fig.alt="The End", out.width = "50%", echo = FALSE, fig.align='center'}
knitr::include_graphics(here::here("modules", "Day_3", "images", "rat_data.png"))
```

## Say we have some data about samples in a diet study:

```{r}
head(teratology2)
```

## Oh dear...

This needs lots of recoding.

```{r, eval = FALSE}
data_diet %>%
  count(Gender)
```

## `dplyr` can help!{.codesmall}

Using Excel to find all of the different ways `gender` has been coded,
could be hectic! In `dplyr` you can use the `recode` function.

::: {style="color: red;"}
(need `mutate` for data frames/tibbles!)
:::
::: codeexample
```{r, eval = FALSE}
# General Format - this is not code!
{data_input} %>%
  mutate({variable_to_fix} = recode({Variable_fixing}, {old_value} = {new_value},
                                       {another_old_value} = {new_value}))

```
:::

## recode() function

::: {style="color: red;"}
Need quotes for new values! Tolerates quotes for old values.
:::

```{r, eval = FALSE}

data_diet %>% 
  mutate(Gender = recode(Gender, M = "Male", 
                                 m = "Male", 
                               Man = "Male",
                                 O = "Other",
                                 f = "Female",
                                 F = "Female")) %>%
  count(Gender, Diet)
```

## `recode()`

```{r, eval = FALSE}

data_diet %>% 
  mutate(Gender = recode(Gender, M = "Male", 
                                 m = "Male", 
                               Man = "Male",
                                 O = "Other",
                                 f = "Female",
                                 F = "Female")) %>%
  count(Gender)
```


## Or you can use `case_when()`

The `case_when()` function of `dplyr` can help us to do this as well.

It is more flexible and powerful. 

::: {style="color: red;"}
(need `mutate` here too!)
:::

## Or you can use `case_when()`{.codesmall}

::: {style="color: red;"}
Need quotes for conditions and new values!
:::




## `case_when()` drops unspecified values

Note that automatically values not reassigned explicitly by
`case_when()` will be `NA` unless otherwise specified.

::: codeexample
```{r, eval = FALSE}
# General Format - this is not code!
{data_input} %>%
  mutate({variable_to_fix} = case_when({Variable_fixing}   
             /some condition/ ~ {value_for_con},
                         TRUE ~ {value_for_not_meeting_condition})

```
:::

{value_for_not_meeting_condition} could be something new 
or it can be the original values of the column




## Another reason for `case_when()`

`case_when` can do very sophisticated comparisons

```{r, eval = FALSE}

data_diet <- data_diet %>% 
      mutate(Effect = case_when(Weight_change > 0 ~ "Increase",
                                Weight_change == 0 ~ "Same",
                                Weight_change < 0 ~ "Decrease"))

head(data_diet)

```

## Now it is easier to see what is happening

```{r, eval = FALSE}
data_diet %>% 
  count(Diet, Effect)
```



## Summary
 - `recode()` and `case_when()` require `mutate()` when working with dataframes/tibbles
-   `recode()` can help with simple recoding (not based on condition but **exact** swap) (only need quotes for new values - but it tolerates redundant quotes)
-   `case_when()` can recode **entire values** based on **conditions** (need quotes for conditions and new values)
    -   remember `case_when()` needs `TRUE ~ varaible` to keep values that aren't specified by conditions, otherwise will be `NA`
    
## Summary Continued

-   `stringr` package has great functions for looking for specific **parts of values** especially `filter()` and `str_detect()` combined
- `stringr`  also has other useful string functions like `str_detect()` (finding patterns in a column or vector), `str_subset()` (parsing text), `str_replace()` (replacing the first instance in values), `str_replace_all()` (replacing all instances in each value) and more!
- `separate()` can split columns into additional columns
- `unite()` can combine columns
- `:` can indicate when you want to start and end with columns next to one another


## Lab Part 2

üè† [Class Website](https://jhudatascience.org/intro_to_r/)    
üíª[Lab](https://jhudatascience.org/intro_to_r/modules/Data_Cleaning/lab/Data_Cleaning_Lab.Rmd)

```{r, fig.alt="The End", out.width = "50%", echo = FALSE, fig.align='center'}
knitr::include_graphics(here::here("images/the-end-g23b994289_1280.jpg"))
```

Image by <a href="https://pixabay.com/users/geralt-9301/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=812226">Gerd Altmann</a> from <a href="https://pixabay.com//?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=812226">Pixabay</a>


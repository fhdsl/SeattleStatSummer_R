---
title: "Factors Lab Key"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Part 1

0. Load all the libraries we will use in this lab. 

```{r}
library(dplyr)
library(ggplot2)
```

1. Load the Youth Tobacco Survey data (using `jhur::read_yts()`) and name it "yts". `select` "Sample_Size" and "Education".

```{r}
yts <- jhur::read_yts() %>% select(Sample_Size, Education, LocationAbbr)
# Alt:
# yts <- read_csv("http://jhudatascience.org/intro_to_R_class/data/Youth_Tobacco_Survey_YTS_Data.csv")
```

2. Create a boxplot showing the difference in "Sample_Size" between Middle School and High School "Education". **Hint**: Use `aes(x = Education, y = Sample_Size)` and `geom_boxplot()`.

```{r}
ggplot(data = yts, aes(x = Education, y = Sample_Size)) +
  geom_boxplot()
```

3. Use `group_by` and `tally` to count up the number of lines of data per "Education" group.

```{r}
yts %>% group_by(Education) %>% tally()
```

4. Make "Education" a factor and reorder so that "Middle School" comes before "High School". Make this change and assign the output the name "yts_fct".

```{r}
yts_fct <- yts %>% mutate(Education = factor(Education, levels = 
              c("Middle School", "High School")))
```

5. Repeat #2 and #3 using the "yts_fct" data. You should see different ordering in the plot and `tally` table.

```{r}
ggplot(data = yts_fct, aes(x = Education, y = Sample_Size)) +
  geom_boxplot()

yts_fct %>% group_by(Education) %>% tally()
```


**BONUS**

6. Convert "LocationAbbr" (state) in "yts_fct" into a factor. Do not worry about ordering the levels for now. Use the `mutate` function.

```{r}
yts_fct <- yts_fct %>% mutate(LocationAbbr = factor(LocationAbbr))
```

7. We want to create a new column that contains the group-level median sample size. Group "yts_fct" by "LocationAbbr" using `group_by`. Then, use `mutate` to create a new column "med_sample_size" that is the median "Sample_Size". Since you have already done `group_by`, a median "Sample_Size" will automatically be created for each unique level in "LocationAbbr". **Hint**: Use the `median` function with `na.rm = TRUE`.

```{r}
yts_fct <- yts_fct %>% group_by(LocationAbbr) %>% mutate(med_sample_size = median(Sample_Size, na.rm = TRUE))
```

8. We want to plot the "LocationAbbr" (state) by ascending median sample size ("med_sample_size"). Using the `forcats` package, create a plot that:

- Has "LocationAbbr" on the x-axis
- Uses the `mapping` argument and the `fct_reorder` function to order the x-axis by "med_sample_size"
- Has "Sample_Size" on the y-axis
- Is a boxplot (`geom_boxplot`)

```{r}
library(forcats)

yts_fct %>%
  ggplot(mapping = aes(x = fct_reorder(LocationAbbr, med_sample_size),
                       y = Sample_Size)) +
  geom_boxplot()
```

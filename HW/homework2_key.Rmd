---
title: '**KEY** Introduction to R: Homework 2'
output:
  html_document: default
---

### **Instructions**

1. Please submit your filled out .Rmd file to the assignment drop box on CoursePlus: https://courseplus.jhu.edu/core/index.cfm/go/db:assignment.submit/assignmentID/40988/coID/16733/ 

2. All assignments are due by the end of the grading period for this term (Wednesday, Jan 26, 2022 at 11:59pm EST). Please reach out to us if you need help before this time!

### **Getting Started**

In this assignment, we will be working with a dataset from the "Kaggle" website, which hosts competitions for prediction and machine learning. More details on this dataset are here: https://www.kaggle.com/c/DontGetKicked/overview/background.

```{r initiatePackages, message=FALSE}
## you can add more, or change...these are suggestions
library(tidyverse)
library(readr)
library(dplyr)
library(ggplot2)
library(tidyr)
```

### **Problem Set**

1\. Make a new variable: Type out your birthday in day-month-year format (1-Jan) and assign it to a new variable "bday".

```{r}
bday <- "5-Nov"
```

2\. Combine "bday" with a character string that contains your name. Name this newly combined variable "me".

```{r}
name <- "Guy Fawkes"
me <- c(bday, name)
# OR
me <- c(bday, "Guy Fawkes")
```

3\. Determine the data class for "me".

```{r}
class(me)
```

<span style="color:red"> The class for "me" is `r class(me)`. </span>

4\. If I want to do `me / 2` I get the following error: `Error in me/2 : non-numeric argument to binary operator`. Why? Include your answer in a comment inside the R chunk.

```{r}
# R cannot perform operations (math) on character data.
```

**Now let's move to the dataset.**

5\. Get the dataset: https://jhudatascience.org/intro_to_R_class/data/kaggleCarAuction.csv. You can use the link, download it, or use whatever method you like for getting the file. Read the data set in using `read_csv()` and name the dataset "cars".

```{r}
cars <- read_csv("https://jhudatascience.org/intro_to_R_class/data/kaggleCarAuction.csv")

# OR

url <- "https://jhudatascience.org/intro_to_R_class/data/kaggleCarAuction.csv"
cars <- read_csv(url)

# OR

download.file("https://jhudatascience.org/intro_to_R_class/data/kaggleCarAuction.csv",
              destfile = "cars_data.csv",
              overwrite = TRUE, 
              mode = "wb")
cars <- read_csv("cars_data.csv")
```

6\. Import the data "dictionary" from https://jhudatascience.org/intro_to_R_class/data/Carvana_Data_Dictionary_formatted.txt. Use the `read_tsv()` function and name this data "key". 

```{r}
key <- read_tsv("https://jhudatascience.org/intro_to_R_class/data/Carvana_Data_Dictionary_formatted.txt")

# OR

download.file("https://jhudatascience.org/intro_to_R_class/data/Carvana_Data_Dictionary_formatted.txt",
              destfile = "dict.txt",
              overwrite = TRUE, 
              mode = "wb")
key <- read_tsv("dict.txt")
```

7\. Save the `cars` data in an .rds file so you can access the data later. Use the `write_rds()` function.

```{r}
write_rds(cars, file = "kaggle.rds")
```

8\. The first three columns of the cars data are "RefId", "IsBadBuy", and "PurchDate". Retrieve the full column specification for this data so that you can see what class type these columns are (e.g., col_character(), col_double()). Write these first three specifications in a comment.

```{r}
spec(cars)
# RefId = col_double()
# IsBadBuy = col_double()
# PurchDate = col_character()
```

9\. How many cars are in the dataset? How many variables are recorded for each car? 

```{r q5}
dim(cars) # cars = the number of rows and variables = the number of columns
nrow(cars)
```

<span style="color:red"> There are `r nrow(cars)` cars in the dataset and `r ncol(cars)` variables. </span>

10\. Filter out (i.e., remove) any vehicles that cost less than or equal to $5000 ("VehBCost") or that have missing values. Reassign the new filtered dataset to "cars". How many vehicles are left after filtering?

**Hint:** the `filter()` function also removes missing values.

```{r}
cars <- filter(cars, VehBCost > 5000)
nrow(cars)
# OR
cars <- cars %>% filter(VehBCost > 5000)
nrow(cars)
```

<span style="color:red"> There are `r nrow(cars)` cars after filtering by price. </span>

11\. From this point on, work with the filtered "cars" dataset from the above question. Given the average car loan today is 70 months, create a new variable (column) called "MonthlyPrice" that shows the monthly cost (Divide "VehBCost" by 70). Check to make sure the new column is there.

**Hint:** use the `mutate()` function.

```{r}
cars <- cars %>% mutate(MonthlyPrice = VehBCost / 70)
# OR
cars <- mutate(cars, MonthlyPrice = VehBCost / 70)

colnames(cars)
```

12\. What is the range of the manufacturer's years of the vehicles? Use "VehYear".

```{r}
range( cars %>% pull(VehYear) )

# OR

car_range <- pull(cars, VehYear)
range(car_range)

# OR

range(cars$VehYear)
table(cars$VehYear)
```

<span style="color:red"> The range is `r range( cars %>% pull(VehYear) )`. </span>

13\. How many cars were from before 2004, and what percent/proportion do these represent?

**Hint:** use `summarize()` and `group_by()`, `filter()`, or `sum()`.

```{r}
# How many cars were from before 2004?
nrow(cars %>% filter(VehYear < 2004)) 
# OR
cars %>% group_by(VehYear < 2004) %>% summarize(total = n())
# OR
sum(cars$VehYear < 2004)
# OR 
table(cars$VehYear < 2004)

# what percent/proportion do these represent?
nrow(cars %>% filter(VehYear < 2004)) / nrow(cars)
# OR
mean(cars$VehYear < 2004)
```

<span style="color:red"> Cars from before 2004 are `r 100* mean(cars$VehYear < 2004)`% of the total. </span>

14\. How many different vehicle manufacturers/makes ("Make") are there?

**Hint:** use `table()`, `group_by()` with `tally()`, or `length()` with `unique()`

```{r}
length(unique(cars %>% pull(Make)))
# OR
length(unique(cars$Make))
# OR
length(table(cars$Make))
# OR
cars %>% group_by(Make) %>% tally()
```

<span style="color:red"> `r length(unique(cars$Make))` unique makes. </span>

15)\. How many different vehicle models ("Model") are there?

```{r}
length(unique(cars %>% pull(Model)))
```

<span style="color:red"> `r length(unique(cars$Model))` unique models. </span>

16\. Which vehicle color had the highest average acquisition cost paid for the vehicle at time of purchase, and what was this cost?

**Hint:** use  `group_by()` with `summarize()`. Be sure to use the key to find the column that corresponds to the acquisition cost paid for the vehicle at time of purchase by looking at the data dictionary / key you read in earlier!

```{r}
cars %>% group_by(Color) %>% 
  summarize(mean = mean(VehBCost)) %>% 
  arrange(desc(mean))
```

17\. Which vehicle color had the highest variability in acquisition cost paid for the vehicle at time of purchase?

```{r}
cars %>% group_by(Color) %>% 
  summarize(var = var(VehBCost)) %>% 
  arrange(desc(var))
```

18\. How many vehicles (using `filter()` or `sum()` ) were red and have fewer than 30,000 miles?

```{r}
sum(cars$Color == "RED" & cars$VehOdo < 30000)
# OR
cars %>% filter(Color == "RED" & VehOdo < 30000) %>% tally()
# OR
cars %>% filter(Color == "RED" & VehOdo < 30000) %>% count()
```

<span style="color:red"> A total of `r sum(cars$Color == "RED" & cars$VehOdo < 30000)` cars. </span>

19\. How many vehicles (using `filter()` or `sum()` ) are blue or red?

```{r}
sum(cars$Color == "BLUE" | cars$Color == "RED" )
# OR
sum(cars$Color %in% c("BLUE","RED"))
# OR
cars %>% filter(Color == "BLUE" | Color == "RED" ) %>% count()
# OR
cars %>% filter(Color %in% c("BLUE","RED")) %>% count()
```

<span style="color:red"> A total of `r sum(cars$Color %in% c("BLUE","RED"))` cars. </span>

20\. How many vehicles (using `filter()` or `sum()` ) are made by Chrysler or Nissan and are white or silver?

```{r}
sum((cars$Make == "CHRYSLER" | cars$Make=="NISSAN") & (cars$Color == "WHITE" | cars$Color == "SILVER" ))
# OR
sum(cars$Make %in% c("CHRYSLER","NISSAN") & cars$Color %in% c("WHITE","SILVER" ))
# OR
cars %>% filter(Make %in% c("CHRYSLER","NISSAN") & cars$Color %in% c("WHITE","SILVER" )) %>% count()
```

<span style="color:red"> A total of `r sum((cars$Make == "CHRYSLER" | cars$Make=="NISSAN") & (cars$Color == "WHITE" | cars$Color == "SILVER" ))` cars. </span>

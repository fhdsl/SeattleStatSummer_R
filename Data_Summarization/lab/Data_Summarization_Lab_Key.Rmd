---
title: "Data Summarization Lab Key"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



# Data used

Bike Lanes Dataset: BikeBaltimore is the Department of Transportation's bike program. 
The data is from http://data.baltimorecity.gov/Transportation/Bike-Lanes/xzfj-gyms

You can Download as a CSV in your current working directory.  Note its also available at: 	http://jhudatascience.org/intro_to_r/data/Bike_Lanes.csv 

```{r}
library(readr)
library(dplyr)
library(tidyverse)
library(jhur)

bike = read_csv(
  "http://jhudatascience.org/intro_to_r/data/Bike_Lanes.csv")
```


or use 
```{r}
library(jhur)
bike = read_bike()
```

# Part 1

1. How many bike "lanes" are currently in Baltimore?  You can assume each observation/row is a different bike "lane".  (hint: how do you get the number of rows of a data set? You can use `dim()` or `nrow()`).
```{r q1}
nrow(bike)
dim(bike)
bike %>% 
  nrow()
```

2. How many (a) feet and (b) miles of bike "lanes" are currently in Baltimore, based on the `length` column? (`5280` feet in a mile).

```{r q2}
# (a)
sum(bike$length)
sum(bike %>% pull(length))

#
sum(bike$length)/5280
sum(bike$length/5280)
sum(bike %>% pull(length)) / 5280
```

3. How many types of bike lanes are there?   (Hints: `unique`, `table`, or `bike %>% count()` on the column named `type`).
   
```{r q3}
table(bike$type, useNA = "ifany")
unique(bike$type)
length(table(bike$type))
length(unique(bike$type))

is.na(unique(bike$type))

counts = bike %>% 
  count(type)
```

4. Which bike lane`type` has (a) the most number of and (b) longest average bike lane length? (Hint: `group_by` and `summarize`)

```{r q4}
bike %>% 
  group_by(type) %>% 
  summarize(number_of_rows = n(),
            mean = mean(length))
```

5. Take your code from the above question, adding another pipe (`%>%`) and `arrange()` to sort the output by `mean`.

```{r q5}
bike %>% 
  group_by(type) %>% 
  summarize(number_of_rows = n(),
            mean = mean(length)) %>% 
  arrange(mean)
```

6. Zeros aren't a very meaningful value for year. Change any zeros in `bike$dateInstalled` to `NA`. For the curious,`ifelse()` in R works takes the same arguments as the "IF" function in Excel!

```{r q6}
bike = bike %>% 
  mutate(dateInstalled = ifelse(dateInstalled == 0, NA, dateInstalled))

bike$dateInstalled[bike$dateInstalled == "0"] = NA

# How to find NAs?
is.na(bike$dateInstalled)
!is.na(bike$dateInstalled)
```

7. What was the average bike lane length grouped by `dateInstalled`? Remove `NA`s with `na.rm = TRUE`.

```{r q7}
bike %>%
  group_by(dateInstalled) %>% 
  summarise(mean_of_the_bike = mean(length, na.rm = F))

# Can combine 6 & 7! 
mean(bike$length[ !is.na(bike$dateInstalled)])

bike %>% 
  mutate(length = ifelse(length == 0, NA, length)) %>% 
  group_by(dateInstalled) %>% 
  summarise(n = n(), # Add this column if you want!
            mean_of_the_bike = mean(length, na.rm = TRUE),
            n_missing = sum(is.na(length))) # Add this column if you want!

            
```

# Part 2

8.  Describe the distribution of bike "lane" lengths:
    (a) Numerically [hint: `quantile()`, using `bike$length`] and 
		(b) graphically [hint: `qplot()` with `geom = "histogram"` or `geom = "density")`].
```{r q8}
quantile(bike$length)

qplot(x = length, data = bike, geom = "histogram")
qplot(x = log10(length), data = bike, geom = "histogram")

hist(bike$length)
hist(bike$length,breaks=100)

hist(log2(bike$length),breaks=100)
hist(log10(bike$length),breaks=100)
```

9. Then describe as above, after stratifying by  i) type (`type`) then ii) number of lanes (`numLanes`) using `geom = "boxplot"`: 
```{r q9}
qplot(y = length, x = type, data = bike, geom = "boxplot")
qplot(y = length, x = factor(numLanes), data = bike, geom = "boxplot")
```

```{r}
boxplot(bike$length~bike$type)
boxplot(bike$length~bike$type, las=3)
boxplot(bike$length~bike$numLanes)

bike$length[1] = NA

boxplot(log10(bike$length)~bike$type)


bike %>% 
  group_by(type) %>% 
  summarize(q0.7 = quantile(length, na.rm = TRUE, probs =0.7))

```

